@include
"core/R/datcache.loc"
"core/R/atomic.loc"

@source R

# Load a builtin R dataset and return
load_data <- function(x) {
  eval(parse(text=x))
}

# Normalize numeric columns
normalize <- function(x) {
  as.data.frame(lapply(x, function(x) (x - mean(x)) / sd(x)))
}

columns_are_numeric <- function(x) {
  all(sapply(x, is.numeric)) 
}

plot_pdf <- function(x, path){
    pdf(path)
    plot(x)
    dev.off()
}

map <- function(f, x){
    lapply(x, f)
}

# Inner <- function(x){
#     pdf(paste0("f-", x, ".pdf"))
#     plot(hclust(dist(normalize(load_data(x)))))
#     dev.off()
# }

@path
# Main :: null . map . `Inner` (c . "iris" "cars" "mtcars")

Main :: null . map . &Inner (c . "iris" "cars" "mtcars")

Inner :: null . hclust . dist . normalize . load_data


@lang
* :: R

# @cache
# hclust,dist,normalize,load_data :: RESET

# @check
# normalize :: columns_are_numeric . <load_data>
# map :: all . sapply . `exists` c
#
# @hook
# null := plot_pdf . <hclust> `"z.pdf"`
