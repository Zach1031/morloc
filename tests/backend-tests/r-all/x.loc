@include
"core/datcache.loc"
"core/atomic.loc"
"core/type.loc"

@source R

# Load a builtin R dataset and return
load_data <- function() {
  data(iris, envir=environment())
  iris$Species <- NULL
  iris
}

# Normalize numeric columns
normalize <- function(x) {
  as.data.frame(lapply(x, function(x) (x - mean(x)) / sd(x)))
}

columns_are_numeric <- function(x) {
  all(sapply(x, is.numeric)) 
}

plot_pdf <- function(x, path){
    pdf(path)
    plot(x)
    dev.off()
}

@export
null as main

@path
null . hclust . dist . normalize . load_data

@lang
* :: R

@cache
hclust,dist,normalize :: datcache

@check
normalize := columns_are_numeric . <load_data>

@fail
normalize :: warning . "Invalid input to _normalize_"

@3
null := plot_pdf . <hclust> "z.pdf"
